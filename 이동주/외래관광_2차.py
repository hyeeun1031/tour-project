# -*- coding: utf-8 -*-
"""ì™¸ë˜ê´€ê´‘ 2ì°¨.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1qd4JYkNMZBch_qjHZBesBbQRHv7gxVOr
"""

# Commented out IPython magic to ensure Python compatibility.
# %%capture
# !pip install koreanize-matplotlib
# import koreanize_matplotlib
# import matplotlib.pyplot as plt
# import pandas as pd

import pandas as pd

# í´ëŸ¬ìŠ¤í„°ë§ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
df_cluster1_2024 = pd.read_csv("/content/cluster1.csv", index_col=0)

# ì›ë³¸ ë°ì´í„°
#df_2024 = pd.read_excel("/content/2024 ì™¸ë˜ê´€ê´‘ê°ì¡°ì‚¬_Data.xlsx")
#df_2023 = pd.read_excel("/content/2023 ì™¸ë˜ê´€ê´‘ê°ì¡°ì‚¬ DATA.xlsx")

# 1. ê¸°ì¤€ êµ­ê°€ ì½”ë“œ ì¶”ì¶œ (ì¤‘ë³µ ì œê±°)
nat_codes_2024 = df_cluster1_2024['D_NAT'].unique()

# 2. df_2023ì—ì„œ í•´ë‹¹ êµ­ê°€ ì½”ë“œë§Œ í•„í„°ë§
df_cluster1_2023 = df_2023[df_2023['D_NAT'].isin(nat_codes_2024)].copy()

nat_codebook = {
    1.0: "ì¤‘êµ­", 2.0: "ì¼ë³¸", 3.0: "ëŒ€ë§Œ", 4.0: "ë¯¸êµ­", 5.0: "í™ì½©",
    6.0: "íƒœêµ­", 7.0: "ë² íŠ¸ë‚¨", 8.0: "ë§ë ˆì´ì‹œì•„", 9.0: "í•„ë¦¬í•€", 10.0: "ì‹±ê°€í¬ë¥´",
    11.0: "ëŸ¬ì‹œì•„", 12.0: "ì¤‘ë™", 13.0: "ì¸ë„ë„¤ì‹œì•„", 14.0: "ìºë‚˜ë‹¤", 15.0: "í˜¸ì£¼",
    16.0: "ì˜êµ­", 17.0: "ëª½ê³¨", 18.0: "ë…ì¼", 19.0: "í”„ë‘ìŠ¤", 20.0: "ì¸ë„",
    97.0: "ê¸°íƒ€"
}

# êµ­ê°€ëª…ì„ ì¶”ê°€í•˜ê³  ì‹¶ì„ ê²½ìš°
df_cluster1_2023['êµ­ê°€ëª…'] = df_cluster1_2023['D_NAT'].map(nat_codebook)

df_cluster1_2024['ì¬ë°©ë¬¸ì'].value_counts(normalize=True)

df_cluster1_2024['Q13'].value_counts().sort_index()

df_cluster1_2024['ì´ì•¡1ì¸TOT2'].describe()

rating_map = {
    'â‘  ë§¤ìš° ë¶ˆë§Œì¡±': 1,
    'â‘¡ ë¶ˆë§Œì¡±': 2,
    'â‘¢ ë³´í†µ': 3,
    'â‘£ ë§Œì¡±': 4,
    'â‘¤ ë§¤ìš° ë§Œì¡±': 5
}

# 1. ë§Œì¡±ë„ í•­ëª©
satisfaction_cols = [f'Q12a{str(i).zfill(2)}' for i in range(1, 27)]

# 2. rating_map ì ìš© í›„ ìˆ«ìí˜•ìœ¼ë¡œ ë³€í™˜
df_satisfaction_numeric = df_cluster1_2024[satisfaction_cols].replace(rating_map).apply(pd.to_numeric, errors='coerce')

# 3. í‰ê·  ê³„ì‚°
satisfaction_means = df_satisfaction_numeric.mean()

# Q12a ì½”ë“œë³„ ì„¤ëª… ë§¤í•‘ ë”•ì…”ë„ˆë¦¬
q12a_labels = {
    "Q12a01": "ì‹ë„ë½",
    "Q12a02": "ì‡¼í•‘",
    "Q12a03": "ìì—°ê²½ê´€",
    "Q12a04": "íœ´ì–‘/ì›°ë‹ˆìŠ¤",
    "Q12a05": "ê³ ê¶/ì—­ì‚¬",
    "Q12a06": "ì „í†µë¬¸í™”ì²´í—˜",
    "Q12a07": "ë°•ë¬¼ê´€/ì „ì‹œê´€",
    "Q12a08": "K-POP/ë“œë¼ë§ˆ",
    "Q12a09": "ê³µì—° ê´€ëŒ",
    "Q12a10": "ì§€ì—­ ì¶•ì œ",
    "Q12a11": "ìœ í¥",
    "Q12a12": "ì˜¤ë½/í…Œë§ˆíŒŒí¬",
    "Q12a13": "ë·°í‹°/ë¯¸ìš©",
    "Q12a14": "ì¹˜ë£Œ/ê±´ê°•ê²€ì§„",
    "Q12a15": "ìŠ¤í¬ì¸  ê´€ëŒ",
    "Q12a16": "ìŠ¤í¬ì¸  ì°¸ê°€",
    "Q12a17": "êµ­ì œíšŒì˜",
    "Q12a18": "ë¹„ì¦ˆë‹ˆìŠ¤ í™œë™",
    "Q12a19": "ì—°ìˆ˜/êµìœ¡",
    "Q12a20": "ê¸°íƒ€ í™œë™",
    "Q12a21": "ê³µì—°ê´€ëŒ",
    "Q12a22": "ì‡¼í•‘í™˜ê²½",
    "Q12a23": "ê¸¸ì°¾ê¸°",
    "Q12a24": "ê´€ê´‘ì•ˆë‚´ì„œë¹„ìŠ¤",
    "Q12a25": "ìŠ¤ë§ˆíŠ¸ê´€ê´‘ì„œë¹„ìŠ¤",
    "Q12a26": "ë””ì§€í„¸ ê´€ê´‘ì •ë³´",
    "Q12a27": "í•œêµ­ì—¬í–‰ì‚¬/ê°€ì´ë“œ"
}


#  ì‚¬ëŒì´ ë³´ê¸° ì¢‹ì€ ë¼ë²¨ë¡œ ì¸ë±ìŠ¤ ì´ë¦„ ë°”ê¾¸ê¸°
satisfaction_means_labeled = satisfaction_means.rename(index=q12a_labels)


# ë§¤í•‘ëœ í‰ê· ê°’ ì‹œë¦¬ì¦ˆ ë°˜í™˜
satisfaction_means_labeled

import matplotlib.pyplot as plt

# ì‹œê°í™”ë¥¼ ìœ„í•œ í‰ê·  ë°ì´í„° ë‹¤ì‹œ ì •ì˜
rating_map = {
    'â‘  ë§¤ìš° ë¶ˆë§Œì¡±': 1,
    'â‘¡ ë¶ˆë§Œì¡±': 2,
    'â‘¢ ë³´í†µ': 3,
    'â‘£ ë§Œì¡±': 4,
    'â‘¤ ë§¤ìš° ë§Œì¡±': 5
}

# í…ìŠ¤íŠ¸ â†’ ìˆ«ì ë³€í™˜
df_satisfaction_mapped = df_cluster1_2024[satisfaction_cols].replace(rating_map)
satisfaction_means_converted = df_satisfaction_mapped.apply(pd.to_numeric, errors='coerce').mean().sort_values()

# 1. ë§Œì¡±ë„ ì ìˆ˜ ìˆ«ìí™”
satisfaction_cols = [f'Q12a{str(i).zfill(2)}' for i in range(1, 27)]
df_satisfaction_numeric = df_cluster1_2024[satisfaction_cols].replace(rating_map).apply(pd.to_numeric, errors='coerce')

# 2. í‰ê·  ê³„ì‚°
satisfaction_means = df_satisfaction_numeric.mean()

# 3. í•œê¸€ ë¼ë²¨ë¡œ ì¸ë±ìŠ¤ ë³€ê²½
satisfaction_means_labeled = satisfaction_means.rename(index=q12a_labels)

# 4. ì •ë ¬ í›„ ì‹œê°í™”
import matplotlib.pyplot as plt

plt.figure(figsize=(10, 10))
satisfaction_means_labeled.sort_values().plot(kind='barh', color='skyblue')
plt.xlabel('í‰ê·  ë§Œì¡±ë„ (1~5)')
plt.ylabel('ë§Œì¡±ë„ í•­ëª©')
plt.title('2024 ì™¸ë˜ê´€ê´‘ê° ë§Œì¡±ë„ í‰ê·  (ë‚®ì€ ìˆœ)')
plt.tight_layout()
plt.show()

# ë§¤í•‘ëœ í•œê¸€ ë¼ë²¨ ê¸°ì¤€ìœ¼ë¡œ ìˆ˜í‰ ë§‰ëŒ€ê·¸ë˜í”„ ì‹œê°í™”
plt.figure(figsize=(8, 10))
satisfaction_means_labeled.plot(kind='barh', color='skyblue')
plt.title('2024 ì™¸ë˜ê´€ê´‘ê° ë§Œì¡±ë„ í‰ê·  (ë‚®ì€ ìˆœ)', fontsize=14)
plt.xlabel('í‰ê·  ë§Œì¡±ë„ (1~5)', fontsize=12)
plt.ylabel('ë§Œì¡±ë„ í•­ëª©', fontsize=12)
plt.grid(axis='x', linestyle='--', alpha=0.7)
plt.tight_layout()
plt.show()

import pandas as pd
import seaborn as sns
import matplotlib.pyplot as plt

# 1. ë³€ìˆ˜ ë¦¬ìŠ¤íŠ¸ ë° ë¼ë²¨ ì •ì˜
q12_cols = [f'Q12a{str(i).zfill(2)}' for i in range(1, 27)]

q12_labels = {
    'Q12a01': 'ì‹ë„ë½(ìŒì‹)', 'Q12a02': 'ì‡¼í•‘', 'Q12a03': 'ìì—°ê²½ê´€ ê°ìƒ',
    'Q12a04': 'ê³ ê¶/ì—­ì‚¬ ìœ ì ì§€ ë°©ë¬¸', 'Q12a05': 'ì „í†µë¬¸í™”ì²´í—˜', 'Q12a06': 'ë°•ë¬¼ê´€/ì „ì‹œê´€ ê´€ëŒ',
    'Q12a07': 'K-POP/ë“œë¼ë§ˆ ì´¬ì˜ì§€', 'Q12a08': 'ê³µì—° ê´€ëŒ(ë®¤ì§€ì»¬ ë“±)', 'Q12a09': 'ì§€ì—­ ì¶•ì œ ì°¸ì—¬',
    'Q12a10': 'ìœ í¥(ì¹´ì§€ë…¸ ë“±)', 'Q12a11': 'ì˜¤ë½(ë†€ì´ê³µì› ë“±)', 'Q12a12': 'ë·°í‹°/ë¯¸ìš© ê´€ê´‘',
    'Q12a13': 'ì¹˜ë£Œ/ê±´ê°•ê²€ì§„', 'Q12a14': 'ìŠ¤í¬ì¸  ê´€ëŒ', 'Q12a15': 'ìŠ¤í¬ì¸  ì°¸ê°€',
    'Q12a16': 'ì¶œì…êµ­ ì ˆì°¨', 'Q12a17': 'ì–¸ì–´ì†Œí†µ', 'Q12a18': 'ì¹˜ì•ˆ',
    'Q12a19': 'ì—¬í–‰ ê²½ë¹„', 'Q12a20': 'ìˆ™ë°• ì‹œì„¤', 'Q12a21': 'ëŒ€ì¤‘êµí†µ',
    'Q12a22': 'ê¸¸ ì°¾ê¸°', 'Q12a23': 'ê´€ê´‘ì•ˆë‚´ì„œë¹„ìŠ¤', 'Q12a24': 'ëª¨ë°”ì¼/ì¸í„°ë„· í¸ì˜',
    'Q12a25': 'ë””ì§€í„¸ ê´€ê´‘ ì •ë³´', 'Q12a26': 'í•œêµ­ì—¬í–‰ì‚¬/ê°€ì´ë“œ'
}

# êµ­ê°€ ì½”ë“œ â†’ êµ­ê°€ëª… ë§¤í•‘
nation_map = {
    1: 'ì¤‘êµ­', 2: 'ì¼ë³¸', 3: 'ëŒ€ë§Œ', 4: 'ë¯¸êµ­', 5: 'í™ì½©',
    6: 'íƒœêµ­', 7: 'ë² íŠ¸ë‚¨', 8: 'ë§ë ˆì´ì‹œì•„', 9: 'í•„ë¦¬í•€', 10: 'ì‹±ê°€í¬ë¥´',
    11: 'ëŸ¬ì‹œì•„', 12: 'ì¤‘ë™', 13: 'ì¸ë„ë„¤ì‹œì•„', 14: 'ìºë‚˜ë‹¤', 15: 'í˜¸ì£¼',
    16: 'ì˜êµ­', 17: 'ëª½ê³¨', 18: 'ë…ì¼', 19: 'í”„ë‘ìŠ¤', 20: 'ì¸ë„',
    97: 'ê¸°íƒ€'
}

# 2. í•„ìš”í•œ ì»¬ëŸ¼ë§Œ ì¶”ì¶œ ë° ë§¤í•‘
df_q12 = df_2024[['D_NAT', 'weight'] + q12_cols].copy()
df_q12['nation'] = df_q12['D_NAT'].map(nation_map)
df_q12 = df_q12.drop(columns='D_NAT')
df_q12 = df_q12.rename(columns=q12_labels)

# 3. êµ­ê°€ë³„ ê°€ì¤‘ í‰ê·  í•¨ìˆ˜ ì •ì˜
def weighted_mean(group):
    w = group['weight']
    return (group.drop(columns=['nation', 'weight']).multiply(w, axis=0)).sum() / w.sum()

# 4. êµ­ê°€ë³„ ê°€ì¤‘ í‰ê·  ê³„ì‚°
mean_by_nation = df_q12.groupby('nation').apply(weighted_mean)

# 5. íˆíŠ¸ë§µ ì‹œê°í™”
plt.figure(figsize=(14, 10))
sns.heatmap(mean_by_nation.T, annot=True, cmap='Greens', vmin=3.5, vmax=5, fmt=".1f")
plt.title('êµ­ê°€ë³„ ì„¸ë¶€ ë§Œì¡±ë„ íˆíŠ¸ë§µ (Q12 í•­ëª©)', fontsize=16)
plt.xlabel('êµ­ê°€')
plt.ylabel('ë§Œì¡±ë„ í•­ëª©')
plt.tight_layout()
plt.show()

# 1. ë³€ìˆ˜ ì„¤ì •
q12_cols = [f'Q12a{str(i).zfill(2)}' for i in range(1, 27)]

q12_labels = {
    'Q12a01': 'ì‹ë„ë½(ìŒì‹)', 'Q12a02': 'ì‡¼í•‘', 'Q12a03': 'ìì—°ê²½ê´€ ê°ìƒ',
    'Q12a04': 'ê³ ê¶/ì—­ì‚¬ ìœ ì ì§€ ë°©ë¬¸', 'Q12a05': 'ì „í†µë¬¸í™”ì²´í—˜', 'Q12a06': 'ë°•ë¬¼ê´€/ì „ì‹œê´€ ê´€ëŒ',
    'Q12a07': 'K-POP/ë“œë¼ë§ˆ ì´¬ì˜ì§€', 'Q12a08': 'ê³µì—° ê´€ëŒ(ë®¤ì§€ì»¬ ë“±)', 'Q12a09': 'ì§€ì—­ ì¶•ì œ ì°¸ì—¬',
    'Q12a10': 'ìœ í¥(ì¹´ì§€ë…¸ ë“±)', 'Q12a11': 'ì˜¤ë½(ë†€ì´ê³µì› ë“±)', 'Q12a12': 'ë·°í‹°/ë¯¸ìš© ê´€ê´‘',
    'Q12a13': 'ì¹˜ë£Œ/ê±´ê°•ê²€ì§„', 'Q12a14': 'ìŠ¤í¬ì¸  ê´€ëŒ', 'Q12a15': 'ìŠ¤í¬ì¸  ì°¸ê°€',
    'Q12a16': 'ì¶œì…êµ­ ì ˆì°¨', 'Q12a17': 'ì–¸ì–´ì†Œí†µ', 'Q12a18': 'ì¹˜ì•ˆ',
    'Q12a19': 'ì—¬í–‰ ê²½ë¹„', 'Q12a20': 'ìˆ™ë°• ì‹œì„¤', 'Q12a21': 'ëŒ€ì¤‘êµí†µ',
    'Q12a22': 'ê¸¸ ì°¾ê¸°', 'Q12a23': 'ê´€ê´‘ì•ˆë‚´ì„œë¹„ìŠ¤', 'Q12a24': 'ëª¨ë°”ì¼/ì¸í„°ë„· í¸ì˜',
    'Q12a25': 'ë””ì§€í„¸ ê´€ê´‘ ì •ë³´', 'Q12a26': 'í•œêµ­ì—¬í–‰ì‚¬/ê°€ì´ë“œ'
}

# 2. ì»¬ëŸ¼ ì¶”ì¶œ ë° ë¼ë²¨ë§
df_revisit = df_2024[['Q13', 'weight'] + q12_cols].copy()
df_revisit = df_revisit.rename(columns=q12_labels)

# 3. ì¬ë°©ë¬¸ ì˜í–¥ ë²”ì£¼ ë¼ë²¨ë§
q13_map = {
    1: 'ì „í˜€ ê·¸ë ‡ì§€ ì•Šë‹¤',
    2: 'ë³„ë¡œ ê·¸ë ‡ì§€ ì•Šë‹¤',
    3: 'ë³´í†µ',
    4: 'ëŒ€ì²´ë¡œ ê·¸ë ‡ë‹¤',
    5: 'ë§¤ìš° ê·¸ë ‡ë‹¤'
}
df_revisit['revisit_intent'] = df_revisit['Q13'].map(q13_map)

# 4. ê·¸ë£¹ë³„ ê°€ì¤‘ í‰ê·  ê³„ì‚°
def weighted_mean(group):
    w = group['weight']
    return (group.drop(columns=['Q13', 'weight', 'revisit_intent']).multiply(w, axis=0)).sum() / w.sum()

mean_by_revisit = df_revisit.groupby('revisit_intent').apply(weighted_mean)

plt.figure(figsize=(14, 6))
sns.heatmap(mean_by_revisit.T, annot=True, cmap='YlGnBu', vmin=3.5, vmax=5, fmt=".1f")
plt.title('ì¬ë°©ë¬¸ ì˜í–¥ ê·¸ë£¹ë³„ ë§Œì¡±ë„ ë¹„êµ (Q12 í•­ëª©)', fontsize=16)
plt.xlabel('ì¬ë°©ë¬¸ ì˜í–¥')
plt.ylabel('ë§Œì¡±ë„ í•­ëª©')
plt.tight_layout()
plt.show()

# 1. ì‚¬ìš©í•  ì»¬ëŸ¼ ì •ì˜
q4_cols = ['Q4_2a1', 'Q4_2a2', 'Q4_2a3']
q12_cols = [f'Q12a{str(i).zfill(2)}' for i in range(1, 27)]

# Q12 ë¼ë²¨
q12_labels = {
    'Q12a01': 'ì‹ë„ë½(ìŒì‹)', 'Q12a02': 'ì‡¼í•‘', 'Q12a03': 'ìì—°ê²½ê´€ ê°ìƒ',
    'Q12a04': 'ê³ ê¶/ì—­ì‚¬ ìœ ì ì§€ ë°©ë¬¸', 'Q12a05': 'ì „í†µë¬¸í™”ì²´í—˜', 'Q12a06': 'ë°•ë¬¼ê´€/ì „ì‹œê´€ ê´€ëŒ',
    'Q12a07': 'K-POP/ë“œë¼ë§ˆ ì´¬ì˜ì§€', 'Q12a08': 'ê³µì—° ê´€ëŒ(ë®¤ì§€ì»¬ ë“±)', 'Q12a09': 'ì§€ì—­ ì¶•ì œ ì°¸ì—¬',
    'Q12a10': 'ìœ í¥(ì¹´ì§€ë…¸ ë“±)', 'Q12a11': 'ì˜¤ë½(ë†€ì´ê³µì› ë“±)', 'Q12a12': 'ë·°í‹°/ë¯¸ìš© ê´€ê´‘',
    'Q12a13': 'ì¹˜ë£Œ/ê±´ê°•ê²€ì§„', 'Q12a14': 'ìŠ¤í¬ì¸  ê´€ëŒ', 'Q12a15': 'ìŠ¤í¬ì¸  ì°¸ê°€',
    'Q12a16': 'ì¶œì…êµ­ ì ˆì°¨', 'Q12a17': 'ì–¸ì–´ì†Œí†µ', 'Q12a18': 'ì¹˜ì•ˆ',
    'Q12a19': 'ì—¬í–‰ ê²½ë¹„', 'Q12a20': 'ìˆ™ë°• ì‹œì„¤', 'Q12a21': 'ëŒ€ì¤‘êµí†µ',
    'Q12a22': 'ê¸¸ ì°¾ê¸°', 'Q12a23': 'ê´€ê´‘ì•ˆë‚´ì„œë¹„ìŠ¤', 'Q12a24': 'ëª¨ë°”ì¼/ì¸í„°ë„· í¸ì˜',
    'Q12a25': 'ë””ì§€í„¸ ê´€ê´‘ ì •ë³´', 'Q12a26': 'í•œêµ­ì—¬í–‰ì‚¬/ê°€ì´ë“œ'
}

# 2. ë°ì´í„° ì¤€ë¹„
df_info = df_2024[q4_cols + q12_cols + ['weight']].copy()
df_info = df_info.rename(columns=q12_labels)

# 3. í•­ëª©ë³„ ë§Œì¡±ë„ ì°¨ì´ ê³„ì‚°
diff_results = {}

for col in q4_cols:
    group1 = df_info[df_info[col] == 1]
    group0 = df_info[df_info[col] != 1]

    def wavg(df):
        return (df.drop(columns=q4_cols + ['weight']).multiply(df['weight'], axis=0)).sum() / df['weight'].sum()

    mean1 = wavg(group1)
    mean0 = wavg(group0)
    diff = mean1 - mean0
    diff_results[col] = diff

# 4. ê²°ê³¼ ì •ë¦¬
df_diff = pd.DataFrame(diff_results).T
df_diff.index = ['ë°©ë¬¸ì§€ì •ë³´ ë¶€ì¡±', 'êµí†µì •ë³´ ë¶€ì¡±', 'ìŒì‹ì •ë³´ ë¶€ì¡±']
df_diff.index.name = 'ì •ë³´ ë¶€ì¡± í•­ëª©'

plt.figure(figsize=(14, 5))
sns.heatmap(df_diff, cmap='coolwarm', center=0, annot=True, fmt=".2f")
plt.title('ì •ë³´ ë¶€ì¡± ì—¬ë¶€ì— ë”°ë¥¸ ë§Œì¡±ë„ ì°¨ì´ (ê°€ì¤‘ í‰ê· )', fontsize=16)
plt.xlabel('ë§Œì¡±ë„ í•­ëª©')
plt.ylabel('ì •ë³´ ë¶€ì¡± í•­ëª©')
plt.tight_layout()
plt.show()

# 1. ë³€ìˆ˜ ì„¤ì •
info_cols = ['Q4_2a1', 'Q4_2a2', 'Q4_2a3']
nation_col = 'D_NAT'
weight_col = 'weight'

info_labels = {
    'Q4_2a1': 'ë°©ë¬¸ì§€ì •ë³´ ë¶€ì¡±',
    'Q4_2a2': 'êµí†µì •ë³´ ë¶€ì¡±',
    'Q4_2a3': 'ìŒì‹ì •ë³´ ë¶€ì¡±',
}

nation_map = {
    1: 'ì¤‘êµ­', 2: 'ì¼ë³¸', 3: 'ëŒ€ë§Œ', 4: 'ë¯¸êµ­', 5: 'í™ì½©',
    6: 'íƒœêµ­', 7: 'ë² íŠ¸ë‚¨', 8: 'ë§ë ˆì´ì‹œì•„', 9: 'í•„ë¦¬í•€', 10: 'ì‹±ê°€í¬ë¥´',
    11: 'ëŸ¬ì‹œì•„', 12: 'ì¤‘ë™', 13: 'ì¸ë„ë„¤ì‹œì•„', 14: 'ìºë‚˜ë‹¤', 15: 'í˜¸ì£¼',
    16: 'ì˜êµ­', 17: 'ëª½ê³¨', 18: 'ë…ì¼', 19: 'í”„ë‘ìŠ¤', 20: 'ì¸ë„',
    97: 'ê¸°íƒ€'
}

# 2. í•„ìš”í•œ ì»¬ëŸ¼ ì¶”ì¶œ
df_info = df_2024[[nation_col, weight_col] + info_cols].copy()
df_info['nation'] = df_info[nation_col].map(nation_map)

# 3. í•­ëª©ë³„ êµ­ê°€ë³„ ì‘ë‹µë¥  ê³„ì‚° (ê°€ì¤‘ì¹˜ ê¸°ë°˜)
results = {}

for col in info_cols:
    df_info['selected'] = (df_info[col] == 1).astype(int)
    grouped = df_info.groupby('nation').apply(
        lambda g: (g['selected'] * g[weight_col]).sum() / g[weight_col].sum()
    )
    results[info_labels[col]] = grouped * 100  # í¼ì„¼íŠ¸ë¡œ ë³€í™˜

# 4. ê²°ê³¼ ì •ë¦¬
df_result = pd.DataFrame(results)
df_result = df_result.round(1)

plt.figure(figsize=(12, 8))
sns.heatmap(df_result.T, annot=True, cmap='OrRd', fmt='.1f', cbar_kws={'label': 'ì •ë³´ ë¶€ì¡± ì‘ë‹µë¥  (%)'})
plt.title('êµ­ê°€ë³„ ì •ë³´ ë¶€ì¡± ê²½í—˜ ë¹„êµ', fontsize=16)
plt.xlabel('êµ­ê°€')
plt.ylabel('ì •ë³´ ë¶€ì¡± í•­ëª©')
plt.tight_layout()
plt.show()

"""# í´ëŸ¬ìŠ¤í„°ë§ ë°ì´í„°"""

likert_map = {
    'â‘  ë§¤ìš° ë¶ˆë§Œì¡±': 1,
    'â‘¡ ë¶ˆë§Œì¡±': 2,
    'â‘¢ ë³´í†µ': 3,
    'â‘£ ë§Œì¡±': 4,
    'â‘¤ ë§¤ìš° ë§Œì¡±': 5,
    'ëª¨ë¦„/ ë¬´ì‘ë‹µ': None,  # ê²°ì¸¡ê°’ ì²˜ë¦¬
    'ëª¨ë¦„': None,
    'ë¬´ì‘ë‹µ': None
}

# ë§Œì¡±ë„ í•­ëª© ë¦¬ìŠ¤íŠ¸
satisfaction_cols = [f'Q12a{str(i).zfill(2)}' for i in range(1, 27)]

# ë§¤í•‘ ì ìš©
for col in satisfaction_cols:
    df_cluster1_2024[col] = df_cluster1_2024[col].map(likert_map)

df_cluster1_2024['weight'] = pd.to_numeric(df_cluster1_2024['weight'], errors='coerce')

# 1. í´ëŸ¬ìŠ¤í„° ë°ì´í„°ì™€ Q12 í•­ëª© ë³‘í•©
df_q12_numerical = df_2024[['pnid', 'D_NAT', 'weight'] + q12_cols].copy()
merged_df_numerical = pd.merge(df_cluster1_2024[['pnid', 'cluster']], df_q12_numerical, on='pnid', how='left')


# 2. êµ­ê°€ë³„ ê°€ì¤‘ í‰ê·  ê³„ì‚°
def weighted_mean(group):
    w = group['weight']
    return group[q12_cols].multiply(w, axis=0).sum() / w.sum()

mean_by_nation_final = merged_df_numerical.groupby('D_NAT').apply(weighted_mean)
mean_by_nation_final = mean_by_nation_final.rename(columns=q12_labels)

# êµ­ê°€ ì½”ë“œ â†’ êµ­ê°€ëª… ë§¤í•‘ ì‚¬ì „
nation_map = {
    1: 'ì¤‘êµ­', 2: 'ì¼ë³¸', 3: 'ëŒ€ë§Œ', 4: 'ë¯¸êµ­', 5: 'í™ì½©',
    6: 'íƒœêµ­', 7: 'ë² íŠ¸ë‚¨', 8: 'ë§ë ˆì´ì‹œì•„', 9: 'í•„ë¦¬í•€', 10: 'ì‹±ê°€í¬ë¥´',
    11: 'ëŸ¬ì‹œì•„', 12: 'ì¤‘ë™', 13: 'ì¸ë„ë„¤ì‹œì•„', 14: 'ìºë‚˜ë‹¤', 15: 'í˜¸ì£¼',
    16: 'ì˜êµ­', 17: 'ëª½ê³¨', 18: 'ë…ì¼', 19: 'í”„ë‘ìŠ¤', 20: 'ì¸ë„',
    97: 'ê¸°íƒ€'
}

# êµ­ê°€ ì½”ë“œ indexë¥¼ êµ­ê°€ëª…ìœ¼ë¡œ ë§¤í•‘
mean_by_nation_final.index = mean_by_nation_final.index.map(nation_map)

# 3. íˆíŠ¸ë§µ ì‹œê°í™”
plt.figure(figsize=(16, 10))
sns.heatmap(mean_by_nation_final.T, annot=True, cmap='YlGnBu', vmin=3.5, vmax=5, fmt=".1f")
plt.title('êµ­ê°€ë³„ ì„¸ë¶€ ë§Œì¡±ë„ íˆíŠ¸ë§µ (Q12 í•­ëª©)', fontsize=16)
plt.xlabel('êµ­ê°€')
plt.ylabel('ë§Œì¡±ë„ í•­ëª©')
plt.tight_layout()
plt.show()

# ìµœì¢… ë°ì´í„° í™•ì¸
mean_by_nation_final.head(10)

# 1. Q12 ì»¬ëŸ¼ ëª©ë¡ ì •ì˜
q12_cols = [f'Q12a{str(i).zfill(2)}' for i in range(1, 27)]

# 2. ë¼ë²¨ ë§¤í•‘ ë”•ì…”ë„ˆë¦¬
q12_labels = {
    'Q12a01': 'ì‹ë„ë½',
    'Q12a02': 'ì‡¼í•‘',
    'Q12a03': 'ìˆ™ë°•',
    'Q12a04': 'êµí†µ',
    'Q12a05': 'ê´€ê´‘ì§€',
    'Q12a06': 'ì²´í—˜ í™œë™',
    'Q12a07': 'ì–¸ì–´ ì†Œí†µ',
    'Q12a08': 'ê°€ê²© ëŒ€ë¹„ ë§Œì¡±ë„',
    'Q12a09': 'í™˜ëŒ€',
    'Q12a10': 'ë‚ ì”¨',
    'Q12a11': 'ì•ˆì „',
    'Q12a12': 'ì²­ê²°',
    'Q12a13': 'í™”ì¥ì‹¤',
    'Q12a14': 'ì¸í„°ë„· í™˜ê²½',
    'Q12a15': 'ê³µê³µ êµí†µ',
    'Q12a16': 'í¸ì˜ì„±',
    'Q12a17': 'ê´€ê´‘ ì•ˆë‚´ì†Œ',
    'Q12a18': 'ì´ë™ í¸ì˜ì„±',
    'Q12a19': 'ì •ë³´ ì ‘ê·¼ì„±',
    'Q12a20': 'í‘œì§€íŒ ë° ì•ˆë‚´',
    'Q12a21': 'ë¬¸í™” ì²´í—˜',
    'Q12a22': 'ìˆ™ë°• ë¹„ìš©',
    'Q12a23': 'ê¸¸ì°¾ê¸°',
    'Q12a24': 'ê´€ê´‘ ì•ˆë‚´ ì„œë¹„ìŠ¤',
    'Q12a25': 'ìŠ¤ë§ˆíŠ¸ ê´€ê´‘ ì„œë¹„ìŠ¤',
    'Q12a26': 'ë””ì§€í„¸ ê´€ê´‘ ì •ë³´'
}

# 3. ê°€ì¤‘ í‰ê·  ê³„ì‚°
satisfaction_means = merged_df_numerical[q12_cols].apply(
    lambda col: (col * merged_df_numerical['weight']).sum() / merged_df_numerical['weight'].sum()
)

# 4. ë¼ë²¨ ì ìš©
satisfaction_means_labeled = satisfaction_means.rename(index=q12_labels)

# êµ­ê°€ë³„ ì „ì²´ í‰ê·  ê³„ì‚°
nation_means = mean_by_nation_final.mean(axis=1)

# í‰ê· ì´ ê°€ì¥ ë‚®ì€ êµ­ê°€
lowest_nation = nation_means.idxmin()
lowest_nation_score = nation_means.min()

print(f"ğŸ“‰ í‰ê· ì´ ê°€ì¥ ë‚®ì€ êµ­ê°€ëŠ” '{lowest_nation}'ì´ë©°, í‰ê·  ë§Œì¡±ë„ëŠ” {lowest_nation_score:.2f}ì ì…ë‹ˆë‹¤.")

# í•­ëª©ë³„ ì „ì²´ í‰ê·  ê³„ì‚°
satisfaction_means = mean_by_nation_final.mean(axis=0)

# í‰ê· ì´ ê°€ì¥ ë‚®ì€ í•­ëª©
lowest_item = satisfaction_means.idxmin()
lowest_item_score = satisfaction_means.min()

print(f"ğŸ“‰ í‰ê· ì´ ê°€ì¥ ë‚®ì€ ë§Œì¡±ë„ í•­ëª©ì€ '{lowest_item}'ì´ë©°, í‰ê· ì€ {lowest_item_score:.2f}ì ì…ë‹ˆë‹¤.")

# ë§Œì¡±ë„ í•­ëª© ë¦¬ìŠ¤íŠ¸
satisfaction_cols = [f'Q12a{str(i).zfill(2)}' for i in range(1, 27)]

# ì»¬ëŸ¼ëª… ì •ë¦¬ (ì„ íƒ)
df_cluster1_2024 = df_cluster1_2024.rename(columns={'Q13': 'revisit_intention'})

# ê·¸ë£¹í™”
grouped = df_cluster1_2024.groupby(['cluster', 'revisit_intention'])

# ê°€ì¤‘ í‰ê·  ê³„ì‚°
def weighted_mean(x):
    return (x[satisfaction_cols].multiply(x['weight'], axis=0)).sum() / x['weight'].sum()

# ì ìš©
weighted_satisfaction = grouped.apply(weighted_mean).reset_index()

import seaborn as sns
import matplotlib.pyplot as plt

# ë³´ê¸° ì¢‹ê²Œ reshape
heatmap_df = weighted_satisfaction.set_index(['cluster', 'revisit_intention'])

# í•­ëª©ëª… í•œê¸€ë¡œ ë°”ê¾¸ê³  ì‹¶ìœ¼ë©´ ë§¤í•‘
label_map = {
    'Q12a01': 'ì‹ë„ë½', 'Q12a02': 'ì‡¼í•‘', 'Q12a03': 'ìì—°ê²½ê´€', 'Q12a04': 'íœ´ì–‘/íœ´ì‹',
    'Q12a05': 'ì—­ì‚¬ìœ ì ', 'Q12a06': 'ì „í†µë¬¸í™”ì²´í—˜', 'Q12a07': 'ë°•ë¬¼ê´€ ì „ì‹œê´€', 'Q12a08': 'K-POP/í•œë¥˜ê³µì—°',
    'Q12a09': 'ì—°ê·¹Â·ë®¤ì§€ì»¬', 'Q12a10': 'í…Œë§ˆíŒŒí¬', 'Q12a11': 'ê²¨ìš¸ìŠ¤í¬ì¸ ', 'Q12a12': 'ê³¨í”„',
    'Q12a13': 'ì˜ë£Œê´€ê´‘', 'Q12a14': 'ì‚°ì—…ì‹œì°°', 'Q12a15': 'êµìœ¡ì—°ìˆ˜', 'Q12a16': 'ì „í†µì‹œì¥',
    'Q12a17': 'ëŒ€í˜•ë§ˆíŠ¸', 'Q12a18': 'ë©´ì„¸ì ', 'Q12a19': 'ë°±í™”ì ', 'Q12a20': 'ê¸°íƒ€ ì‡¼í•‘',
    'Q12a21': 'ëŒ€ì¤‘êµí†µ', 'Q12a22': 'íƒì‹œ', 'Q12a23': 'ê¸¸ì°¾ê¸°', 'Q12a24': 'ê´€ê´‘ì•ˆë‚´ì„œë¹„ìŠ¤',
    'Q12a25': 'ìŠ¤ë§ˆíŠ¸ê´€ê´‘ì„œë¹„ìŠ¤', 'Q12a26': 'ë””ì§€í„¸ ê´€ê´‘ì •ë³´'
}
heatmap_df.rename(columns=label_map, inplace=True)

# íˆíŠ¸ë§µ ì‹œê°í™”
plt.figure(figsize=(16, 8))
sns.heatmap(
    heatmap_df,
    annot=True,       # ìˆ«ì í‘œì‹œ ON
    fmt=".2f",        # ì†Œìˆ˜ì  ë‘˜ì§¸ìë¦¬
    cmap='YlGnBu',
    vmin=1, vmax=5
)
plt.title('í´ëŸ¬ìŠ¤í„° + ì¬ë°©ë¬¸ ì˜ì‚¬ë³„ ë§Œì¡±ë„ (ê°€ì¤‘í‰ê· )', fontsize=14)
plt.xlabel('ë§Œì¡±ë„ í•­ëª©')
plt.ylabel('í´ëŸ¬ìŠ¤í„° / ì¬ë°©ë¬¸ ì˜ì‚¬')
plt.tight_layout()
plt.show()

# 1ë²ˆ í´ëŸ¬ìŠ¤í„°ì—ì„œ ì¬ë°©ë¬¸ ì˜í–¥ ê°€ì¥ ë‚®ì€ ê·¸ë£¹ vs ê°€ì¥ ë†’ì€ ê·¸ë£¹ ë¹„êµ
row_low = heatmap_df.loc[(1, 'â‘  ì „í˜€ ê·¸ë ‡ì§€ ì•Šë‹¤')]
row_high = heatmap_df.loc[(1, 'â‘¤ ë§¤ìš° ê·¸ë ‡ë‹¤')]

# í•­ëª©ë³„ ì°¨ì´ ê³„ì‚°
diff = (row_high - row_low).abs().sort_values(ascending=False)

# ì°¨ì´ê°€ ê°€ì¥ í° ìƒìœ„ í•­ëª© 5ê°œ ì¶œë ¥
print(diff.head())

# 1. Q12a02ëŠ” ì´ë¯¸ ìˆ«ìë¡œ ë˜ì–´ ìˆìŒ (1~5)
# 2. ë§Œì¡±ë„ ì ìˆ˜ì™€ êµ­ì ë³„ ê°€ì¤‘ ë¹„ìœ¨ ê³„ì‚°
nationality_by_score = (
    df_cluster1_2024
    .dropna(subset=['Q12a02', 'D_NAT'])
    .groupby(['Q12a02', 'D_NAT'])['weight']
    .sum()
    .groupby(level=0)
    .apply(lambda x: x / x.sum())  # ì ìˆ˜ë³„ ê·¸ë£¹ ë‚´ ì •ê·œí™”
    .unstack(fill_value=0)
)

# 3. í‰ê·  ê¸°ì¤€ ìƒìœ„ êµ­ì  ì¶”ì¶œ (top 10)
top_nationalities = nationality_by_score.mean().sort_values(ascending=False).head(10).index

# 4. ì‹œê°í™”
nationality_by_score[top_nationalities].T.plot(kind='bar', figsize=(14, 6))
plt.title("ì‡¼í•‘ ë§Œì¡±ë„ ì ìˆ˜ë³„ êµ­ì  ë¶„í¬ (ê°€ì¤‘ì¹˜ ë°˜ì˜)", fontsize=14)
plt.xlabel("êµ­ì ")
plt.ylabel("ë¹„ìœ¨")
plt.legend(title="ì‡¼í•‘ ë§Œì¡±ë„ ì ìˆ˜", title_fontsize=12)
plt.xticks(rotation=45)
plt.tight_layout()
plt.show()

# Q12a02 (ì‡¼í•‘ ë§Œì¡±ë„) ìˆ«ìí˜• ë³€í™˜
df_cluster1_2024['Q12a02'] = pd.to_numeric(df_cluster1_2024['Q12a02'], errors='coerce')

# êµ­ì ë³„ ê°€ì¤‘ í‰ê·  ê³„ì‚°
shopping_mean_by_nation = (
    df_cluster1_2024
    .groupby('D_NAT')
    .apply(lambda x: (x['Q12a02'] * x['weight']).sum() / x['weight'].sum())
    .sort_values(ascending=False)
)

# ìƒìœ„ 10ê°œ ì‹œê°í™”
shopping_mean_by_nation.head(10).plot(kind='barh', figsize=(8, 5), title='ì‡¼í•‘ ë§Œì¡±ë„ ìƒìœ„ êµ­ì  (ê°€ì¤‘í‰ê· )')
plt.xlabel('ì‡¼í•‘ ë§Œì¡±ë„')
plt.gca().invert_yaxis()
plt.tight_layout()
plt.show()

import pandas as pd
import matplotlib.pyplot as plt

# 1. ì‡¼í•‘ ì¥ì†Œ ê´€ë ¨ ì»¬ëŸ¼
shopping_cols = ['Q10_3a1', 'Q10_3a2', 'Q10_3a3']

# 2. ì‡¼í•‘ ì¥ì†Œ í•œê¸€ëª… â†’ ì½”ë“œ ë§¤í•‘ (ì—­ë°©í–¥)
shopping_place_rev_map = {
    'ê³µí•­ ë©´ì„¸ì ': 1,
    'ì‹œë‚´ ë©´ì„¸ì ': 2,
    'ë¡œë“œìƒµ': 3,
    'ì „í†µì‹œì¥': 4,
    'ë°±í™”ì ': 5,
    'ëŒ€í˜• ì‡¼í•‘ëª°': 6,
    'ëŒ€í˜•ë§ˆíŠ¸': 7,
    'ê¸°íƒ€': 8
}

# 3. ì½”ë“œ â†’ í•œê¸€ëª… (ì‹œê°í™”ìš©)
shopping_place_map = {v: k for k, v in shopping_place_rev_map.items()}

# 4. rating_map ì •ì˜
rating_map = {
    'ë§¤ìš° ë¶ˆë§Œì¡±': 1,
    'ë¶ˆë§Œì¡±': 2,
    'ë³´í†µ': 3,
    'ë§Œì¡±': 4,
    'ë§¤ìš° ë§Œì¡±': 5
}

# 5. ì‡¼í•‘ ì¥ì†Œë¥¼ ì½”ë“œë¡œ ë³€í™˜
for col in shopping_cols:
    df_cluster1_2024[col + '_code'] = df_cluster1_2024[col].map(shopping_place_rev_map)

# 6. ìˆ«ì ì½”ë“œ ë¦¬ìŠ¤íŠ¸ë¡œ ë³‘í•©
code_cols = [col + '_code' for col in shopping_cols]
df_cluster1_2024['shopping_places'] = df_cluster1_2024[code_cols].values.tolist()

# 7. ì½”ë“œ ì •ë¦¬ í•¨ìˆ˜
def clean_shopping_codes(code_list):
    return [int(x) for x in code_list if pd.notnull(x) and 1 <= int(x) <= 8]

df_cluster1_2024['shopping_places_clean'] = df_cluster1_2024['shopping_places'].apply(clean_shopping_codes)

# 8. ìœ íš¨í•œ í–‰ë§Œ í•„í„°ë§
df_valid = df_cluster1_2024.dropna(subset=['Q12a02', 'weight', 'shopping_places_clean'])

# 9. explodeë¡œ ë¦¬ìŠ¤íŠ¸ í’€ê¸°
df_exploded = df_valid.explode('shopping_places_clean')

# 10. ë§Œì¡±ë„ ì ìˆ˜ ìˆ«ìí™”
df_exploded['Q12a02_numeric'] = df_exploded['Q12a02'].replace(rating_map)

# 11. ê·¸ë£¹ë³„ ê°€ì¤‘ì¹˜ í•©ê³„
group_sum = (
    df_exploded
    .groupby(['Q12a02_numeric', 'shopping_places_clean'])['weight']
    .sum()
    .reset_index()
)

# 12. ë§Œì¡±ë„ ê·¸ë£¹ ë‚´ ë¹„ìœ¨ ê³„ì‚°
group_sum['ratio'] = group_sum.groupby('Q12a02_numeric')['weight'].transform(lambda x: x / x.sum())

# 13. í”¼ë²—
place_by_score = group_sum.pivot(index='Q12a02_numeric', columns='shopping_places_clean', values='ratio').fillna(0)

# 14. ì»¬ëŸ¼ëª… (ì½”ë“œ â†’ í•œê¸€ ì‡¼í•‘ ì¥ì†Œëª…)
place_by_score.columns = place_by_score.columns.map(lambda x: shopping_place_map.get(x, f"ì¥ì†Œ{x}"))

# 15. ìˆ«ìí˜•ìœ¼ë¡œ ê°•ì œ ë³€í™˜
place_by_score = place_by_score.astype(float)

# 16. ì‹œê°í™”
place_by_score.T.plot(kind='bar', figsize=(14, 6))
plt.title("ì‡¼í•‘ ë§Œì¡±ë„ ì ìˆ˜ë³„ ì‡¼í•‘ ì¥ì†Œ ë¶„í¬ (ê°€ì¤‘ì¹˜ ë°˜ì˜)", fontsize=14)
plt.xlabel("ì‡¼í•‘ ì¥ì†Œ")
plt.ylabel("ë¹„ìœ¨")
plt.legend(title="ì‡¼í•‘ ë§Œì¡±ë„ ì ìˆ˜", title_fontsize=12)
plt.xticks(rotation=45)
plt.tight_layout()
plt.show()

import pandas as pd

# 1. ì‡¼í•‘ ì¥ì†Œ ê´€ë ¨ ì»¬ëŸ¼
shopping_cols = ['Q10_3a1', 'Q10_3a2', 'Q10_3a3']

# 2. ì‡¼í•‘ ì¥ì†Œëª… â†’ ì½”ë“œ ë§¤í•‘
shopping_place_rev_map = {
    'ê³µí•­ ë©´ì„¸ì ': 1,
    'ì‹œë‚´ ë©´ì„¸ì ': 2,
    'ë¡œë“œìƒµ': 3,
    'ì „í†µì‹œì¥': 4,
    'ë°±í™”ì ': 5,
    'ëŒ€í˜• ì‡¼í•‘ëª°': 6,
    'ëŒ€í˜•ë§ˆíŠ¸': 7,
    'ê¸°íƒ€': 8
}
shopping_place_map = {v: k for k, v in shopping_place_rev_map.items()}

# 3. ë§Œì¡±ë„ í…ìŠ¤íŠ¸ â†’ ìˆ«ì ë§¤í•‘ (â‘ ~â‘¤ í¬í•¨)
rating_map_fixed = {
    'â‘  ë§¤ìš° ë¶ˆë§Œì¡±': 1,
    'â‘¡ ë¶ˆë§Œì¡±': 2,
    'â‘¢ ë³´í†µ': 3,
    'â‘£ ë§Œì¡±': 4,
    'â‘¤ ë§¤ìš° ë§Œì¡±': 5
}

# 4. ì‡¼í•‘ ì¥ì†Œë¥¼ ì½”ë“œë¡œ ë³€í™˜
for col in shopping_cols:
    df_cluster1_2024[col + '_code'] = df_cluster1_2024[col].map(shopping_place_rev_map)

# 5. ì½”ë“œ ë¦¬ìŠ¤íŠ¸ë¡œ ë³‘í•©
code_cols = [col + '_code' for col in shopping_cols]
df_cluster1_2024['shopping_places'] = df_cluster1_2024[code_cols].values.tolist()

# 6. ì½”ë“œ ë¦¬ìŠ¤íŠ¸ ì •ë¦¬ í•¨ìˆ˜
def clean_shopping_codes(code_list):
    return [int(x) for x in code_list if pd.notnull(x) and 1 <= int(x) <= 8]

df_cluster1_2024['shopping_places_clean'] = df_cluster1_2024['shopping_places'].apply(clean_shopping_codes)

# 7. ì‡¼í•‘ ë§Œì¡±ë„ ìˆ«ìí™”
df_cluster1_2024['Q12a02_numeric'] = df_cluster1_2024['Q12a02'].replace(rating_map_fixed)
df_cluster1_2024['Q12a02_numeric'] = pd.to_numeric(df_cluster1_2024['Q12a02_numeric'], errors='coerce')
df_cluster1_2024['weight'] = pd.to_numeric(df_cluster1_2024['weight'], errors='coerce')

# 8. ìœ íš¨í•œ í–‰ë§Œ í•„í„°ë§
df_valid = df_cluster1_2024.dropna(subset=['Q12a02_numeric', 'weight', 'shopping_places_clean'])

# 9. explodeë¡œ ë¦¬ìŠ¤íŠ¸ í’€ê¸°
df_exploded = df_valid.explode('shopping_places_clean')

# ğŸ” NaN ì œê±° í›„ intë¡œ ë³€í™˜
df_exploded = df_exploded.dropna(subset=['shopping_places_clean'])
df_exploded['place_code'] = df_exploded['shopping_places_clean'].astype(int)


# 10. ì‡¼í•‘ ì¥ì†Œë³„ ê°€ì¤‘ í‰ê·  ë§Œì¡±ë„ ê³„ì‚°
mean_by_place = (
    df_exploded
    .groupby('place_code')
    .apply(lambda g: (g['Q12a02_numeric'] * g['weight']).sum() / g['weight'].sum())
    .reset_index(name='weighted_mean')
    .sort_values(by='weighted_mean', ascending=False)
)

# 11. ì¥ì†Œëª… ë¶™ì´ê¸°
mean_by_place['place_name'] = mean_by_place['place_code'].map(shopping_place_map)

# 12. ê²°ê³¼ ì¶œë ¥
print(mean_by_place[['place_name', 'weighted_mean']])

shopping_item_cols = [f'Q10_2a{str(i).zfill(2)}' for i in range(1, 14)]

for col in shopping_item_cols:
    unique_vals = df_cluster1_2024[col].unique()
    print(f"{col} ê³ ìœ ê°’: {unique_vals}")

# ì‡¼í•‘ í•­ëª© ì»¬ëŸ¼ ë° ë§¤í•‘
shopping_item_cols = [f'Q10_2a{str(i).zfill(2)}' for i in range(1, 14)]
shopping_item_map = {
    'Q10_2a01': 'í–¥ìˆ˜/í™”ì¥í’ˆ',
    'Q10_2a02': 'ì‹ë£Œí’ˆ(ê¹€ì¹˜ ë“±)',
    'Q10_2a03': 'ì˜ë¥˜',
    'Q10_2a04': 'ì‹ ë°œë¥˜',
    'Q10_2a05': 'ê°€ë°©ë¥˜',
    'Q10_2a06': 'ë³´ì„/ì•…ì„¸ì„œë¦¬',
    'Q10_2a07': 'ì¸ì‚¼/í•œì•½ì¬',
    'Q10_2a08': 'ì£¼ë¥˜',
    'Q10_2a09': 'ë‹´ë°°',
    'Q10_2a10': 'ì „í†µ ë¯¼ì˜ˆí’ˆ',
    'Q10_2a11': 'í•œë¥˜ êµ¿ì¦ˆ',
    'Q10_2a12': 'ì „ìì œí’ˆ',
    'Q10_2a13': 'ê¸°íƒ€'
}

# Q12a02ë¥¼ ìˆ«ìí˜•ìœ¼ë¡œ ë³€í™˜
rating_map_fixed = {
    'â‘  ë§¤ìš° ë¶ˆë§Œì¡±': 1,
    'â‘¡ ë¶ˆë§Œì¡±': 2,
    'â‘¢ ë³´í†µ': 3,
    'â‘£ ë§Œì¡±': 4,
    'â‘¤ ë§¤ìš° ë§Œì¡±': 5
}
df_cluster1_2024['Q12a02_numeric'] = df_cluster1_2024['Q12a02'].replace(rating_map_fixed)
df_cluster1_2024['Q12a02_numeric'] = pd.to_numeric(df_cluster1_2024['Q12a02_numeric'], errors='coerce')
df_cluster1_2024['weight'] = pd.to_numeric(df_cluster1_2024['weight'], errors='coerce')

# ê°€ì¤‘ í‰ê·  ê³„ì‚°
item_results = []
for col in shopping_item_cols:
    df_item = df_cluster1_2024[df_cluster1_2024[col].notna()]
    if not df_item.empty:
        weighted_mean = (df_item['Q12a02_numeric'] * df_item['weight']).sum() / df_item['weight'].sum()
        item_results.append({'item_code': col, 'item_name': shopping_item_map[col], 'weighted_mean': weighted_mean})

df_item_mean = pd.DataFrame(item_results).sort_values(by='weighted_mean', ascending=False)

import matplotlib.pyplot as plt

# ì •ë ¬ëœ ë°ì´í„° ê¸°ì¤€
plot_df = df_item_mean.sort_values(by='weighted_mean', ascending=True)

# ì‹œê°í™”
plt.figure(figsize=(10, 6))
bars = plt.barh(plot_df['item_name'], plot_df['weighted_mean'], color='pink', edgecolor='black')

# ì¶• & ì œëª© ì„¤ì •
plt.xlabel('ê°€ì¤‘ í‰ê·  ë§Œì¡±ë„ (1~5)', fontsize=12, color='black')
plt.ylabel('ì‡¼í•‘ í•­ëª©', fontsize=12, color='black')
plt.title('ì‡¼í•‘ í•­ëª©ë³„ í‰ê·  ì‡¼í•‘ ë§Œì¡±ë„ (ê°€ì¤‘ì¹˜ ë°˜ì˜)', fontsize=14, color='black')
plt.xlim(1, 5)
plt.grid(axis='x', linestyle='--', alpha=0.4)
plt.xticks(color='black')
plt.yticks(color='black')
plt.tight_layout()
plt.show()

mq_cols = [f'MQ10_2b{str(i).zfill(2)}' for i in range(1, 14)]

for col in mq_cols:
    unique_vals = df_cluster1_2024[col].unique()
    print(f"{col} ê³ ìœ ê°’:", unique_vals[:10], '...')  # ë„ˆë¬´ ë§ì„ ê²½ìš° ìƒìœ„ 10ê°œë§Œ ì¶œë ¥

import matplotlib.pyplot as plt

# ì‡¼í•‘ í•­ëª©ë³„ êµ¬ë§¤ ë¹„ì¤‘ ì»¬ëŸ¼
mq_cols = [f'MQ10_2b{str(i).zfill(2)}' for i in range(1, 14)]
mq_map = {
    'MQ10_2b01': 'í–¥ìˆ˜/í™”ì¥í’ˆ', 'MQ10_2b02': 'ì‹ë£Œí’ˆ', 'MQ10_2b03': 'ì˜ë¥˜',
    'MQ10_2b04': 'ì‹ ë°œë¥˜', 'MQ10_2b05': 'ê°€ë°©ë¥˜', 'MQ10_2b06': 'ë³´ì„/ì•…ì„¸ì„œë¦¬',
    'MQ10_2b07': 'ì¸ì‚¼/í•œì•½ì¬', 'MQ10_2b08': 'ì£¼ë¥˜', 'MQ10_2b09': 'ë‹´ë°°',
    'MQ10_2b10': 'ì „í†µ ë¯¼ì˜ˆí’ˆ', 'MQ10_2b11': 'í•œë¥˜ êµ¿ì¦ˆ', 'MQ10_2b12': 'ì „ìì œí’ˆ', 'MQ10_2b13': 'ê¸°íƒ€'
}

# í‰ê·  ê³„ì‚° ë° ì •ë¦¬
mq_means = df_cluster1_2024[mq_cols].mean().rename(index=mq_map).sort_values(ascending=False)

# ì‹œê°í™”
plt.figure(figsize=(10, 6))
plt.barh(mq_means.index, mq_means.values, color='pink', edgecolor='black')
plt.xlabel('í‰ê·  êµ¬ë§¤ ë¹„ì¤‘ (%)', fontsize=12)
plt.title('ì „ì²´ ì‡¼í•‘ í•­ëª©ë³„ í‰ê·  êµ¬ë§¤ ë¹„ì¤‘', fontsize=14)
plt.gca().invert_yaxis()
plt.grid(axis='x', linestyle='--', alpha=0.4)
plt.tight_layout()
plt.show()

# í´ëŸ¬ìŠ¤í„°ë³„ í‰ê·  ê³„ì‚°
cluster_mq_mean = df_cluster1_2024.groupby('cluster')[mq_cols].mean()
cluster_mq_mean.columns = [mq_map[col] for col in mq_cols]

# ê° í´ëŸ¬ìŠ¤í„°ë³„ Top 3 í•­ëª© ì¶”ì¶œ
for cluster_id, row in cluster_mq_mean.iterrows():
    top_items = row.sort_values(ascending=False).head(3)
    print(f"[í´ëŸ¬ìŠ¤í„° {cluster_id}] ìƒìœ„ ì‡¼í•‘ í’ˆëª©:")
    for item, pct in top_items.items():
        print(f"  - {item}: {pct:.1f}%")
    print()

# ë§Œì¡±ë„ ìƒìœ„ ê·¸ë£¹: Q12a02_numeric â‰¥ 4
high_sat = df_cluster1_2024[df_cluster1_2024['Q12a02_numeric'] >= 4]

# í•­ëª©ë³„ í‰ê·  ë¹„ì¤‘
mq_highsat_mean = high_sat[mq_cols].mean().rename(index=mq_map).sort_values(ascending=False)

# ì‹œê°í™”
plt.figure(figsize=(10, 6))
plt.barh(mq_highsat_mean.index, mq_highsat_mean.values, color='black', edgecolor='pink')
plt.xlabel('í‰ê·  êµ¬ë§¤ ë¹„ì¤‘ (%)', fontsize=12)
plt.title('ë§Œì¡±ë„ ìƒìœ„ ê·¸ë£¹ì˜ ì‡¼í•‘ í•­ëª©ë³„ êµ¬ë§¤ ë¹„ì¤‘', fontsize=14)
plt.gca().invert_yaxis()
plt.grid(axis='x', linestyle='--', alpha=0.4)
plt.tight_layout()
plt.show()

# ì‡¼í•‘ í•­ëª© ë¹„ì¤‘ê³¼ Q12a02_numeric ê°„ í”¼ì–´ìŠ¨ ìƒê´€ê³„ìˆ˜
mq_corr = df_cluster1_2024[mq_cols + ['Q12a02_numeric']].corr()['Q12a02_numeric'].drop('Q12a02_numeric')
mq_corr = mq_corr.rename(index=mq_map).sort_values(ascending=False)

# ì‹œê°í™”
plt.figure(figsize=(10, 6))
plt.barh(mq_corr.index, mq_corr.values, color='pink', edgecolor='black')
plt.xlabel('í”¼ì–´ìŠ¨ ìƒê´€ê³„ìˆ˜ (r)', fontsize=12)
plt.title('ì‡¼í•‘ í•­ëª© êµ¬ë§¤ ë¹„ì¤‘ê³¼ ë§Œì¡±ë„ ê°„ ìƒê´€ê´€ê³„', fontsize=14)
plt.gca().invert_yaxis()
plt.grid(axis='x', linestyle='--', alpha=0.4)
plt.tight_layout()
plt.show()

# Cì‡¼í•‘ë¹„1ì¸ëŒ€ì²´ ìœ ë‹ˆí¬ ê°’ í™•ì¸
df_cluster1_2024['Cì‡¼í•‘ë¹„1ì¸ëŒ€ì²´'].unique()

# 1. ê·¸ëŒ€ë¡œ ë¶„í¬ ê³„ì‚°
distribution_by_item = {}
for i, col in enumerate(item_cols, start=1):
    item_name = item_names[i]
    subset = df_cluster1_2024[df_cluster1_2024[col].notna() & df_cluster1_2024['Cì‡¼í•‘ë¹„1ì¸ëŒ€ì²´'].notna()]
    counts = subset['Cì‡¼í•‘ë¹„1ì¸ëŒ€ì²´'].value_counts().sort_index()
    ratio = (counts / counts.sum()) * 100
    distribution_by_item[item_name] = ratio

# 2. ë°ì´í„°í”„ë ˆì„ ë³€í™˜
df_dist = pd.DataFrame(distribution_by_item).fillna(0)

# 3. ìˆœì„œ ì§€ì • (í˜„ì¬ ì¡´ì¬í•˜ëŠ” í•­ëª© ê¸°ì¤€)
spend_label_order = ['0$', '0$ ì´ˆê³¼ ~ 30$ ì´í•˜', '30$ ì´ˆê³¼ ~ 100$ ì´í•˜', '100$ ì´ˆê³¼']
df_dist = df_dist.loc[df_dist.index.intersection(spend_label_order)]
df_dist = df_dist.reindex(spend_label_order)

# 4. ì‹œê°í™”
import matplotlib.pyplot as plt
colors = ['#4E79A7', '#F28E2B', '#E15759', '#76B7B2']

plt.figure(figsize=(16, 8))
df_dist.T.plot(
    kind='bar',
    stacked=True,
    color=colors
)

plt.title("ì‡¼í•‘ í•­ëª©ë³„ ì‡¼í•‘ë¹„ êµ¬ê°„ ë¶„í¬", fontsize=16)
plt.xlabel("ì‡¼í•‘ í•­ëª©", fontsize=12)
plt.ylabel("ë¹„ìœ¨ (%)", fontsize=12)
plt.legend(
    title="ì‡¼í•‘ë¹„ êµ¬ê°„",
    labels=spend_label_order,
    bbox_to_anchor=(1.05, 1), loc='upper left'
)
plt.xticks(rotation=45)
plt.tight_layout()
plt.show()

print(df_cluster1_2024['Cì‡¼í•‘ë¹„1ì¸ëŒ€ì²´'].value_counts(dropna=False))

import pandas as pd
import matplotlib.pyplot as plt

# 1. ì§€ì¶œ ë²”ì£¼ (ë¬¸ìì—´) â†’ ì¶”ì • ê¸ˆì•¡ ë§¤í•‘
spend_mapping_str = {
    "1000$ ì´í•˜": 500,
    "1000$ ì´ˆê³¼ - 2000$ ì´í•˜": 1500,
    "2000$ ì´ˆê³¼ - 3000$ ì´í•˜": 2500,
    "3000$ ì´ˆê³¼ - 5000$ ì´í•˜": 4000,
    "5000$ ì´ˆê³¼ - 10000$ ì´í•˜": 7500,
    "10000$ ì´ˆê³¼": 12000,
    "ìµœëŒ€ê¸ˆì•¡ì´ˆê³¼ì": 15000
}

# 2. ì§€ì—­ ì½”ë“œ â†’ ì§€ì—­ëª… ë§¤í•‘
region_codes = {
    "Q9_2a01": "ì„œìš¸", "Q9_2a02": "ê²½ê¸°", "Q9_2a03": "ì¸ì²œ",
    "Q9_2a04": "ê°•ì›", "Q9_2a05": "ëŒ€ì „", "Q9_2a06": "ì¶©ë¶", "Q9_2a07": "ì¶©ë‚¨",
    "Q9_2a08": "ì„¸ì¢…", "Q9_2a09": "ê²½ë¶", "Q9_2a10": "ê²½ë‚¨", "Q9_2a11": "ëŒ€êµ¬",
    "Q9_2a12": "ìš¸ì‚°", "Q9_2a13": "ë¶€ì‚°", "Q9_2a14": "ê´‘ì£¼",
    "Q9_2a15": "ì „ë¶", "Q9_2a16": "ì „ë‚¨", "Q9_2a17": "ì œì£¼"
}

# 3. ì§€ì¶œê¸ˆì•¡(ì¶”ì •) ë³€ìˆ˜ ìƒì„±
df_cluster1_2024["ì§€ì¶œê¸ˆì•¡(ì¶”ì •)"] = df_cluster1_2024["Cì´ì•¡1ì¸TOT2"].map(spend_mapping_str)

# 4. ì§€ì—­ë³„ í‰ê·  ì§€ì¶œ ê³„ì‚°
region_stats = []

for col, region in region_codes.items():
    visited = df_cluster1_2024[df_cluster1_2024[col] == region]
    avg_spend = visited["ì§€ì¶œê¸ˆì•¡(ì¶”ì •)"].mean()
    region_stats.append((region, avg_spend, len(visited)))

# 5. ë°ì´í„°í”„ë ˆì„ ìƒì„± ë° ì •ë ¬
region_spend_df = pd.DataFrame(region_stats, columns=["ì§€ì—­", "í‰ê· ì§€ì¶œ(ì¶”ì •)", "ë°©ë¬¸ììˆ˜"])
region_spend_df = region_spend_df.sort_values(by="í‰ê· ì§€ì¶œ(ì¶”ì •)", ascending=False)

# 6. ì‹œê°í™”
plt.figure(figsize=(10,6))
plt.barh(region_spend_df["ì§€ì—­"], region_spend_df["í‰ê· ì§€ì¶œ(ì¶”ì •)"], color="pink")
plt.xlabel("í‰ê·  ì§€ì¶œ ê¸ˆì•¡ ($)")
plt.title("í´ëŸ¬ìŠ¤í„°1: ë°©ë¬¸ ì§€ì—­ë³„ 1ì¸ í‰ê·  ì§€ì¶œ (ì¶”ì •)")
plt.gca().invert_yaxis()
plt.tight_layout()
plt.show()

# 1~27 í•­ëª©: ë¬¸12. í•­ëª©ë³„ ë§Œì¡±ë„
satisfaction_cols = [f'Q12a{str(i).zfill(2)}' for i in range(1, 28)]

# ë§¤í•‘: í•­ëª© ì´ë¦„
satisfaction_labels = {
    'Q12a01': 'ì‹ë„ë½', 'Q12a02': 'ì‡¼í•‘', 'Q12a03': 'ìì—°ê²½ê´€', 'Q12a04': 'íœ´ì–‘/ì›°ë‹ˆìŠ¤',
    'Q12a05': 'ì—­ì‚¬ìœ ì ', 'Q12a06': 'ì „í†µë¬¸í™”ì²´í—˜', 'Q12a07': 'ë°•ë¬¼ê´€Â·ì „ì‹œê´€',
    'Q12a08': 'K-POP/ì´¬ì˜ì§€', 'Q12a09': 'ê³µì—°Â·ì—°ê·¹', 'Q12a10': 'ë†€ì´ê³µì›Â·í…Œë§ˆíŒŒí¬',
    'Q12a11': 'ìŠ¤í¬ì¸ ê´€ëŒ', 'Q12a12': 'ë ˆì €ìŠ¤í¬ì¸ ì²´í—˜', 'Q12a13': 'ì˜ë£Œê´€ê´‘',
    'Q12a14': 'ì˜¨ì²œ/ì°œì§ˆë°©', 'Q12a15': 'ì¹´ì§€ë…¸', 'Q12a16': 'í•œì‹ë¬¸í™”ì²´í—˜',
    'Q12a17': 'í•œë³µì²´í—˜', 'Q12a18': 'ë·°í‹°ì²´í—˜', 'Q12a19': 'ìš”ë¦¬ì²´í—˜',
    'Q12a20': 'ì „í†µì˜ˆìˆ ê³µì—°', 'Q12a21': 'ì „í†µì‹œì¥', 'Q12a22': 'ì§€ì—­íŠ¹ì‚°í’ˆêµ¬ì…',
    'Q12a23': 'ê¸¸ì°¾ê¸°/êµí†µí¸ì˜', 'Q12a24': 'ê´€ê´‘ì•ˆë‚´ì„œë¹„ìŠ¤', 'Q12a25': 'ìŠ¤ë§ˆíŠ¸ê´€ê´‘ì„œë¹„ìŠ¤',
    'Q12a26': 'ë””ì§€í„¸ ê´€ê´‘ì •ë³´', 'Q12a27': 'ì—¬í–‰ì‚¬/ê°€ì´ë“œ'
}

# ì§€ì—­ ì»¬ëŸ¼
region_cols = [f'Q9_2a{str(i).zfill(2)}' for i in range(1, 18)]
region_labels = {
    'Q9_2a01': 'ì„œìš¸', 'Q9_2a02': 'ê²½ê¸°', 'Q9_2a03': 'ì¸ì²œ', 'Q9_2a04': 'ê°•ì›',
    'Q9_2a05': 'ëŒ€ì „', 'Q9_2a06': 'ì¶©ë¶', 'Q9_2a07': 'ì¶©ë‚¨', 'Q9_2a08': 'ì„¸ì¢…',
    'Q9_2a09': 'ê²½ë¶', 'Q9_2a10': 'ê²½ë‚¨', 'Q9_2a11': 'ëŒ€êµ¬', 'Q9_2a12': 'ìš¸ì‚°',
    'Q9_2a13': 'ë¶€ì‚°', 'Q9_2a14': 'ê´‘ì£¼', 'Q9_2a15': 'ì „ë¶', 'Q9_2a16': 'ì „ë‚¨', 'Q9_2a17': 'ì œì£¼'
}
# Q12a27 ë¬¸ìì—´ â†’ ìˆ«ìí˜•ìœ¼ë¡œ ë§¤í•‘
q27_map = {
    'â‘  ë§¤ìš° ë¶ˆë§Œì¡±': 1,
    'â‘¡ ë¶ˆë§Œì¡±': 2,
    'â‘¢ ë³´í†µ': 3,
    'â‘£ ë§Œì¡±': 4,
    'â‘¤ ë§¤ìš° ë§Œì¡±': 5
}

df['Q12a27'] = df['Q12a27'].map(q27_map)

import numpy as np

# í•„ìš”í•œ ì»¬ëŸ¼ë§Œ ì¶”ì¶œ
cols_needed = ['pnid', 'weight'] + satisfaction_cols + region_cols
df = df_cluster1_2024[cols_needed].copy()

# ì§€ì—­ ë°©ë¬¸ ì—¬ë¶€ melt
df_melted = df.melt(
    id_vars=['pnid', 'weight'] + satisfaction_cols,
    value_vars=region_cols,
    var_name='region_code',
    value_name='visited'
)

# ë°©ë¬¸í•œ ì§€ì—­ë§Œ í•„í„°ë§
df_melted = df_melted[df_melted['visited'] == 1].copy()
df_melted['region_name'] = df_melted['region_code'].map(region_labels)
df_melted['Q12a27'] = df_melted['Q12a27'].map(q27_map)


# Q12a24~Q12a26ì—ì„œ 9 = í•´ë‹¹ ì—†ìŒ â†’ ê²°ì¸¡ ì²˜ë¦¬
for col in ['Q12a24', 'Q12a25', 'Q12a26']:
    df_melted.loc[df_melted[col] == 9, col] = np.nan

def weighted_mean(group):
    w = group['weight']
    valid = group[satisfaction_cols].notna()
    weighted_scores = group[satisfaction_cols].multiply(w, axis=0)
    return weighted_scores.sum() / (w * valid).sum()

region_satisfaction = df_melted.groupby('region_name').apply(weighted_mean)
region_satisfaction.rename(columns=satisfaction_labels, inplace=True)

top_activity_per_region = region_satisfaction.idxmax(axis=1)
top_score_per_region = region_satisfaction.max(axis=1)

plot_df = pd.DataFrame({
    'region': top_activity_per_region.index,
    'top_satisfaction_item': top_activity_per_region.values,
    'mean_score': top_score_per_region.values
}).sort_values(by='mean_score', ascending=False)

import matplotlib.pyplot as plt
import seaborn as sns

plt.figure(figsize=(11, 8))
sns.barplot(
    data=plot_df,
    x='mean_score',
    y='region',
    hue='top_satisfaction_item',
    dodge=False,
    palette=['black', 'deeppink', 'hotpink', 'pink']
)
plt.title('í´ëŸ¬ìŠ¤í„°1: ì§€ì—­ë³„ ìµœê³  ë§Œì¡± í•­ëª© (Q12a01~27 ê¸°ì¤€)', fontsize=14)
plt.xlabel('í‰ê·  ë§Œì¡±ë„ (1~5ì )')
plt.ylabel('ë°©ë¬¸ ì§€ì—­')
plt.legend(title='ìµœê³  ë§Œì¡± í•­ëª©', bbox_to_anchor=(1.05, 1), loc='upper left')
plt.grid(axis='x', linestyle='--', alpha=0.5)
plt.tight_layout()
plt.show()

# ëª¨ë“  ë§Œì¡±ë„ í•­ëª©ì— ëŒ€í•´ ìœ ë‹ˆí¬ ê°’ í™•ì¸
for col in satisfaction_cols:
    print(f"{col} ({satisfaction_labels.get(col, col)}):", sorted(df_cluster1_2024[col].dropna().unique()))

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

# ë¬¸12. ë§Œì¡±ë„ í•­ëª© ë³€ìˆ˜ ë° ë¼ë²¨
satisfaction_cols = [f'Q12a{str(i).zfill(2)}' for i in range(1, 28)]
satisfaction_labels = {
    'Q12a01': 'ì‹ë„ë½', 'Q12a02': 'ì‡¼í•‘', 'Q12a03': 'ìì—°ê²½ê´€', 'Q12a04': 'íœ´ì–‘/ì›°ë‹ˆìŠ¤',
    'Q12a05': 'ì—­ì‚¬ìœ ì ', 'Q12a06': 'ì „í†µë¬¸í™”ì²´í—˜', 'Q12a07': 'ë°•ë¬¼ê´€Â·ì „ì‹œê´€',
    'Q12a08': 'K-POP/ì´¬ì˜ì§€', 'Q12a09': 'ê³µì—°Â·ì—°ê·¹', 'Q12a10': 'ë†€ì´ê³µì›Â·í…Œë§ˆíŒŒí¬',
    'Q12a11': 'ìŠ¤í¬ì¸ ê´€ëŒ', 'Q12a12': 'ë ˆì €ìŠ¤í¬ì¸ ì²´í—˜', 'Q12a13': 'ì˜ë£Œê´€ê´‘',
    'Q12a14': 'ì˜¨ì²œ/ì°œì§ˆë°©', 'Q12a15': 'ì¹´ì§€ë…¸', 'Q12a16': 'í•œì‹ë¬¸í™”ì²´í—˜',
    'Q12a17': 'í•œë³µì²´í—˜', 'Q12a18': 'ë·°í‹°ì²´í—˜', 'Q12a19': 'ìš”ë¦¬ì²´í—˜',
    'Q12a20': 'ì „í†µì˜ˆìˆ ê³µì—°', 'Q12a21': 'ì „í†µì‹œì¥', 'Q12a22': 'ì§€ì—­íŠ¹ì‚°í’ˆêµ¬ì…',
    'Q12a23': 'ê¸¸ì°¾ê¸°/êµí†µí¸ì˜', 'Q12a24': 'ê´€ê´‘ì•ˆë‚´ì„œë¹„ìŠ¤', 'Q12a25': 'ìŠ¤ë§ˆíŠ¸ê´€ê´‘ì„œë¹„ìŠ¤',
    'Q12a26': 'ë””ì§€í„¸ê´€ê´‘ì •ë³´', 'Q12a27': 'ì—¬í–‰ì‚¬/ê°€ì´ë“œ'
}

region_cols = [f'Q9_2a{str(i).zfill(2)}' for i in range(1, 18)]
region_labels = {
    'Q9_2a01': 'ì„œìš¸', 'Q9_2a02': 'ê²½ê¸°', 'Q9_2a03': 'ì¸ì²œ', 'Q9_2a04': 'ê°•ì›',
    'Q9_2a05': 'ëŒ€ì „', 'Q9_2a06': 'ì¶©ë¶', 'Q9_2a07': 'ì¶©ë‚¨', 'Q9_2a08': 'ì„¸ì¢…',
    'Q9_2a09': 'ê²½ë¶', 'Q9_2a10': 'ê²½ë‚¨', 'Q9_2a11': 'ëŒ€êµ¬', 'Q9_2a12': 'ìš¸ì‚°',
    'Q9_2a13': 'ë¶€ì‚°', 'Q9_2a14': 'ê´‘ì£¼', 'Q9_2a15': 'ì „ë¶', 'Q9_2a16': 'ì „ë‚¨', 'Q9_2a17': 'ì œì£¼'
}

# ë¬¸ìì—´ë¡œ ë˜ì–´ ìˆë˜ ì§€ì—­ ì‘ë‹µ â†’ ë°©ë¬¸ ì—¬ë¶€ë¡œ 1/NaN ì²˜ë¦¬
for col in region_cols:
    df_cluster1_2024[col] = df_cluster1_2024[col].apply(lambda x: 1 if pd.notna(x) else np.nan)

# Q12a27 ë¬¸ìí˜• â†’ ìˆ«ìí˜• ë³€í™˜
q27_map = {
    'â‘  ë§¤ìš° ë¶ˆë§Œì¡±': 1,
    'â‘¡ ë¶ˆë§Œì¡±': 2,
    'â‘¢ ë³´í†µ': 3,
    'â‘£ ë§Œì¡±': 4,
    'â‘¤ ë§¤ìš° ë§Œì¡±': 5
}
df_cluster1_2024['Q12a27'] = df_cluster1_2024['Q12a27'].map(q27_map)

# Q12a24~Q12a26: 9 = í•´ë‹¹ ì—†ìŒ â†’ NaN ì²˜ë¦¬
for col in ['Q12a24', 'Q12a25', 'Q12a26']:
    df_cluster1_2024[col] = pd.to_numeric(df_cluster1_2024[col], errors='coerce')
    df_cluster1_2024.loc[df_cluster1_2024[col] == 9, col] = np.nan

# melt
cols_needed = ['pnid', 'weight'] + satisfaction_cols + region_cols
df = df_cluster1_2024[cols_needed].copy()

df_melted = df.melt(
    id_vars=['pnid', 'weight'] + satisfaction_cols,
    value_vars=region_cols,
    var_name='region_code',
    value_name='visited'
)

# ë°©ë¬¸ìë§Œ
df_melted = df_melted[df_melted['visited'] == 1].copy()
df_melted['region_name'] = df_melted['region_code'].map(region_labels)

# 1. ê°€ì¤‘ í‰ê·  í•¨ìˆ˜
def weighted_mean(group):
    w = group['weight']
    valid = group[satisfaction_cols].notna()
    weighted_scores = group[satisfaction_cols].multiply(w, axis=0)
    result = weighted_scores.sum() / (w * valid).sum()
    return pd.Series(result)

# 2. ì ìš©
region_satisfaction = df_melted.groupby('region_name').apply(weighted_mean)
region_satisfaction.index.name = None
region_satisfaction.rename(columns=satisfaction_labels, inplace=True)

# [0] ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë”©
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

# ë§Œì¡±ë„ í•­ëª©
satisfaction_cols = [f'Q12a{str(i).zfill(2)}' for i in range(1, 28)]
satisfaction_labels = {
    'Q12a01': 'ì‹ë„ë½', 'Q12a02': 'ì‡¼í•‘', 'Q12a03': 'ìì—°ê²½ê´€', 'Q12a04': 'íœ´ì–‘/ì›°ë‹ˆìŠ¤',
    'Q12a05': 'ì—­ì‚¬ìœ ì ', 'Q12a06': 'ì „í†µë¬¸í™”ì²´í—˜', 'Q12a07': 'ë°•ë¬¼ê´€Â·ì „ì‹œê´€',
    'Q12a08': 'K-POP/ì´¬ì˜ì§€', 'Q12a09': 'ê³µì—°Â·ì—°ê·¹', 'Q12a10': 'ë†€ì´ê³µì›Â·í…Œë§ˆíŒŒí¬',
    'Q12a11': 'ìŠ¤í¬ì¸ ê´€ëŒ', 'Q12a12': 'ë ˆì €ìŠ¤í¬ì¸ ì²´í—˜', 'Q12a13': 'ì˜ë£Œê´€ê´‘',
    'Q12a14': 'ì˜¨ì²œ/ì°œì§ˆë°©', 'Q12a15': 'ì¹´ì§€ë…¸', 'Q12a16': 'í•œì‹ë¬¸í™”ì²´í—˜',
    'Q12a17': 'í•œë³µì²´í—˜', 'Q12a18': 'ë·°í‹°ì²´í—˜', 'Q12a19': 'ìš”ë¦¬ì²´í—˜',
    'Q12a20': 'ì „í†µì˜ˆìˆ ê³µì—°', 'Q12a21': 'ì „í†µì‹œì¥', 'Q12a22': 'ì§€ì—­íŠ¹ì‚°í’ˆêµ¬ì…',
    'Q12a23': 'ê¸¸ì°¾ê¸°/êµí†µí¸ì˜', 'Q12a24': 'ê´€ê´‘ì•ˆë‚´ì„œë¹„ìŠ¤', 'Q12a25': 'ìŠ¤ë§ˆíŠ¸ê´€ê´‘ì„œë¹„ìŠ¤',
    'Q12a26': 'ë””ì§€í„¸ê´€ê´‘ì •ë³´', 'Q12a27': 'ì—¬í–‰ì‚¬/ê°€ì´ë“œ'
}

# ì§€ì—­ ë°©ë¬¸ í•­ëª©
region_cols = [f'Q9_2a{str(i).zfill(2)}' for i in range(1, 18)]
region_labels = {
    'Q9_2a01': 'ì„œìš¸', 'Q9_2a02': 'ê²½ê¸°', 'Q9_2a03': 'ì¸ì²œ', 'Q9_2a04': 'ê°•ì›',
    'Q9_2a05': 'ëŒ€ì „', 'Q9_2a06': 'ì¶©ë¶', 'Q9_2a07': 'ì¶©ë‚¨', 'Q9_2a08': 'ì„¸ì¢…',
    'Q9_2a09': 'ê²½ë¶', 'Q9_2a10': 'ê²½ë‚¨', 'Q9_2a11': 'ëŒ€êµ¬', 'Q9_2a12': 'ìš¸ì‚°',
    'Q9_2a13': 'ë¶€ì‚°', 'Q9_2a14': 'ê´‘ì£¼', 'Q9_2a15': 'ì „ë¶', 'Q9_2a16': 'ì „ë‚¨', 'Q9_2a17': 'ì œì£¼'
}

cols_needed = ['pnid'] + satisfaction_cols + region_cols
df = df_cluster1_2024[cols_needed].copy()

# melt
df_melted = df.melt(
    id_vars=['pnid'] + satisfaction_cols,
    value_vars=region_cols,
    var_name='region_code',
    value_name='visited'
)

# ë°©ë¬¸ìë§Œ ë‚¨ê¸°ê³  ì§€ì—­ ì´ë¦„ ë§¤í•‘
df_melted = df_melted[df_melted['visited'] == 1].copy()
df_melted['region_name'] = df_melted['region_code'].map(region_labels)

# ì§€ì—­ë³„ í‰ê·  ë§Œì¡±ë„ (weight ì—†ì´)
region_satisfaction = df_melted.groupby('region_name')[satisfaction_cols].mean()
region_satisfaction.rename(columns=satisfaction_labels, inplace=True)

top_activity_per_region = region_satisfaction.idxmax(axis=1)
top_score_per_region = region_satisfaction.max(axis=1)

plot_df = pd.DataFrame({
    'region': top_activity_per_region.index,
    'top_satisfaction_item': top_activity_per_region.values,
    'mean_score': top_score_per_region.values
}).sort_values(by='mean_score', ascending=False)

import matplotlib.pyplot as plt
import seaborn as sns

plt.figure(figsize=(12, 6))
sns.barplot(
    data=plot_df,
    x='region',          # ì§€ì—­ì„ xì¶•
    y='mean_score',      # í‰ê·  ë§Œì¡±ë„ë¥¼ yì¶•
    hue='top_satisfaction_item',
    dodge=False,
    palette='Set2'       # ì„ ëª…í•œ ìƒ‰ìƒ íŒ”ë ˆíŠ¸
)

plt.title('í´ëŸ¬ìŠ¤í„°1: ì§€ì—­ë³„ ìµœê³  ë§Œì¡± í™œë™', fontsize=14)
plt.ylabel('í‰ê·  ë§Œì¡±ë„ (1~5ì )', fontsize=12)
plt.xlabel('ë°©ë¬¸ ì§€ì—­', fontsize=12)
plt.ylim(0, 5.5)
plt.xticks(rotation=45, fontsize=10)
plt.yticks(fontsize=10)
plt.legend(title='ìµœê³  ë§Œì¡± í•­ëª©', bbox_to_anchor=(1.01, 1), loc='upper left')
plt.grid(axis='y', linestyle='--', alpha=0.5)
plt.tight_layout()
plt.show()

import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# [1] ë§Œì¡±ë„ ë¬¸í•­ê³¼ ë¼ë²¨ ì •ì˜
satisfaction_cols = [f'Q12a{str(i).zfill(2)}' for i in range(1, 28)]
satisfaction_labels = {
    'Q12a01': 'ì‹ë„ë½', 'Q12a02': 'ì‡¼í•‘', 'Q12a03': 'ìì—°ê²½ê´€', 'Q12a04': 'íœ´ì–‘/ì›°ë‹ˆìŠ¤',
    'Q12a05': 'ì—­ì‚¬ìœ ì ', 'Q12a06': 'ì „í†µë¬¸í™”ì²´í—˜', 'Q12a07': 'ë°•ë¬¼ê´€Â·ì „ì‹œê´€', 'Q12a08': 'K-POP/ì´¬ì˜ì§€',
    'Q12a09': 'ê³µì—°Â·ì—°ê·¹', 'Q12a10': 'ë†€ì´ê³µì›Â·í…Œë§ˆíŒŒí¬', 'Q12a11': 'ìŠ¤í¬ì¸ ê´€ëŒ', 'Q12a12': 'ë ˆì €ìŠ¤í¬ì¸ ì²´í—˜',
    'Q12a13': 'ì˜ë£Œê´€ê´‘', 'Q12a14': 'ì˜¨ì²œ/ì°œì§ˆë°©', 'Q12a15': 'ì¹´ì§€ë…¸', 'Q12a16': 'í•œì‹ë¬¸í™”ì²´í—˜',
    'Q12a17': 'í•œë³µì²´í—˜', 'Q12a18': 'ë·°í‹°ì²´í—˜', 'Q12a19': 'ìš”ë¦¬ì²´í—˜', 'Q12a20': 'ì „í†µì˜ˆìˆ ê³µì—°',
    'Q12a21': 'ì „í†µì‹œì¥', 'Q12a22': 'ì§€ì—­íŠ¹ì‚°í’ˆêµ¬ì…', 'Q12a23': 'ê¸¸ì°¾ê¸°/êµí†µí¸ì˜',
    'Q12a24': 'ê´€ê´‘ì•ˆë‚´ì„œë¹„ìŠ¤', 'Q12a25': 'ìŠ¤ë§ˆíŠ¸ê´€ê´‘ì„œë¹„ìŠ¤', 'Q12a26': 'ë””ì§€í„¸ê´€ê´‘ì •ë³´', 'Q12a27': 'ì—¬í–‰ì‚¬/ê°€ì´ë“œ'
}

# [2] ì§€ì—­ ì»¬ëŸ¼ ì •ì˜
region_cols = [col for col in df_cluster1_2024.columns if col.startswith('Q9_2a')]
region_labels = {
    'Q9_2a01': 'ì„œìš¸', 'Q9_2a02': 'ê²½ê¸°', 'Q9_2a03': 'ì¸ì²œ', 'Q9_2a04': 'ê°•ì›',
    'Q9_2a05': 'ëŒ€ì „', 'Q9_2a06': 'ì¶©ë¶', 'Q9_2a07': 'ì¶©ë‚¨', 'Q9_2a08': 'ì„¸ì¢…',
    'Q9_2a09': 'ê²½ë¶', 'Q9_2a10': 'ê²½ë‚¨', 'Q9_2a11': 'ëŒ€êµ¬', 'Q9_2a12': 'ìš¸ì‚°',
    'Q9_2a13': 'ë¶€ì‚°', 'Q9_2a14': 'ê´‘ì£¼', 'Q9_2a15': 'ì „ë¶', 'Q9_2a16': 'ì „ë‚¨', 'Q9_2a17': 'ì œì£¼'
}

# [3] melt + ì§€ì—­ í†µí•© + í•„í„°ë§
df_melted = df_cluster1_2024.melt(
    id_vars=region_cols,
    value_vars=satisfaction_cols,
    var_name='activity_code',
    value_name='score'
)
df_melted['activity'] = df_melted['activity_code'].map(satisfaction_labels)

df_melted['region_name'] = None
for col in region_cols:
    df_melted.loc[df_melted[col].notna(), 'region_name'] = region_labels[col]
df_melted = df_melted.drop(columns=region_cols)
df_melted = df_melted[df_melted['score'].between(1, 5)]  # ìœ íš¨ ì‘ë‹µë§Œ

# [4] ì§€ì—­ë³„ Top5 í™œë™ ì¶”ì¶œ
activity_counts = df_melted.groupby(['region_name', 'activity']).size().reset_index(name='count')
top5 = (
    activity_counts
    .sort_values(['region_name', 'count'], ascending=[True, False])
    .groupby('region_name')
    .head(5)
)

# [5] í‰ê·  ë§Œì¡±ë„ ê²°í•©
mean_scores = df_melted.groupby(['region_name', 'activity'])['score'].mean().reset_index(name='mean_score')
top5_with_scores = pd.merge(top5, mean_scores, on=['region_name', 'activity'])

# [6] ì‹œê°í™”
plt.figure(figsize=(14, 8))
sns.barplot(
    data=top5_with_scores,
    x='region_name',
    y='mean_score',
    hue='activity',
    palette='Set1'
)

plt.title('ì§€ì—­ë³„ ì£¼ìš” í™œë™ Top5ì˜ í‰ê·  ë§Œì¡±ë„', fontsize=16)
plt.xlabel('ë°©ë¬¸ ì§€ì—­', fontsize=12)
plt.ylabel('í‰ê·  ë§Œì¡±ë„ (1~5ì )', fontsize=12)
plt.ylim(0, 5.5)
plt.xticks(rotation=45, fontsize=10)
plt.yticks(fontsize=10)
plt.legend(title='í™œë™ í•­ëª©', bbox_to_anchor=(1.02, 1), loc='upper left')
plt.grid(axis='y', linestyle='--', alpha=0.5)
plt.tight_layout()
plt.show()

import pandas as pd
import matplotlib.pyplot as plt

# [1] í™œë™ í•­ëª© ì •ì˜
satisfaction_cols = [f'Q12a{str(i).zfill(2)}' for i in range(1, 28)]
satisfaction_labels = {
    'Q12a01': 'ì‹ë„ë½', 'Q12a02': 'ì‡¼í•‘', 'Q12a03': 'ìì—°ê²½ê´€', 'Q12a04': 'íœ´ì–‘/ì›°ë‹ˆìŠ¤',
    'Q12a05': 'ì—­ì‚¬ìœ ì ', 'Q12a06': 'ì „í†µë¬¸í™”ì²´í—˜', 'Q12a07': 'ë°•ë¬¼ê´€Â·ì „ì‹œê´€', 'Q12a08': 'K-POP/ì´¬ì˜ì§€',
    'Q12a09': 'ê³µì—°Â·ì—°ê·¹', 'Q12a10': 'ë†€ì´ê³µì›Â·í…Œë§ˆíŒŒí¬', 'Q12a11': 'ìŠ¤í¬ì¸ ê´€ëŒ', 'Q12a12': 'ë ˆì €ìŠ¤í¬ì¸ ì²´í—˜',
    'Q12a13': 'ì˜ë£Œê´€ê´‘', 'Q12a14': 'ì˜¨ì²œ/ì°œì§ˆë°©', 'Q12a15': 'ì¹´ì§€ë…¸', 'Q12a16': 'í•œì‹ë¬¸í™”ì²´í—˜',
    'Q12a17': 'í•œë³µì²´í—˜', 'Q12a18': 'ë·°í‹°ì²´í—˜', 'Q12a19': 'ìš”ë¦¬ì²´í—˜', 'Q12a20': 'ì „í†µì˜ˆìˆ ê³µì—°',
    'Q12a21': 'ì „í†µì‹œì¥', 'Q12a22': 'ì§€ì—­íŠ¹ì‚°í’ˆêµ¬ì…', 'Q12a23': 'ê¸¸ì°¾ê¸°/êµí†µí¸ì˜',
    'Q12a24': 'ê´€ê´‘ì•ˆë‚´ì„œë¹„ìŠ¤', 'Q12a25': 'ìŠ¤ë§ˆíŠ¸ê´€ê´‘ì„œë¹„ìŠ¤', 'Q12a26': 'ë””ì§€í„¸ê´€ê´‘ì •ë³´', 'Q12a27': 'ì—¬í–‰ì‚¬/ê°€ì´ë“œ'
}

# [2] ì§€ì—­ ì •ë³´ ì •ì˜
region_cols = [col for col in df_cluster1_2024.columns if col.startswith('Q9_2a')]
region_labels = {
    'Q9_2a01': 'ì„œìš¸', 'Q9_2a02': 'ê²½ê¸°', 'Q9_2a03': 'ì¸ì²œ', 'Q9_2a04': 'ê°•ì›',
    'Q9_2a05': 'ëŒ€ì „', 'Q9_2a06': 'ì¶©ë¶', 'Q9_2a07': 'ì¶©ë‚¨', 'Q9_2a08': 'ì„¸ì¢…',
    'Q9_2a09': 'ê²½ë¶', 'Q9_2a10': 'ê²½ë‚¨', 'Q9_2a11': 'ëŒ€êµ¬', 'Q9_2a12': 'ìš¸ì‚°',
    'Q9_2a13': 'ë¶€ì‚°', 'Q9_2a14': 'ê´‘ì£¼', 'Q9_2a15': 'ì „ë¶', 'Q9_2a16': 'ì „ë‚¨', 'Q9_2a17': 'ì œì£¼'
}

# [3] Melt + ì§€ì—­ ë³‘í•©
df_melted = df_cluster1_2024.melt(
    id_vars=region_cols,
    value_vars=satisfaction_cols,
    var_name='activity_code',
    value_name='score'
)
df_melted['activity'] = df_melted['activity_code'].map(satisfaction_labels)

df_melted['region_name'] = None
for col in region_cols:
    df_melted.loc[df_melted[col].notna(), 'region_name'] = region_labels[col]
df_melted = df_melted.drop(columns=region_cols)
df_melted = df_melted[df_melted['score'].between(1, 5)]

# [4] Top5 í™œë™ í•­ëª© ì¶”ì¶œ ë° í‰ê·  ì ìˆ˜ ê²°í•©
activity_counts = df_melted.groupby(['region_name', 'activity']).size().reset_index(name='count')
top5 = (
    activity_counts
    .sort_values(['region_name', 'count'], ascending=[True, False])
    .groupby('region_name')
    .head(5)
)
mean_scores = df_melted.groupby(['region_name', 'activity'])['score'].mean().reset_index(name='mean_score')
top5_with_scores = pd.merge(top5, mean_scores, on=['region_name', 'activity'])

# [5] íŒŒì´ì°¨íŠ¸ ì‹œê°í™”
regions = top5_with_scores['region_name'].unique()
num_regions = len(regions)
cols = 4
rows = (num_regions + cols - 1) // cols
fig, axes = plt.subplots(rows, cols, figsize=(16, 4 * rows))
axes = axes.flatten()

for idx, region in enumerate(regions):
    region_data = top5_with_scores[top5_with_scores['region_name'] == region]
    labels = region_data['activity']
    scores = region_data['mean_score']

    axes[idx].pie(
        scores,
        labels=[f"{label}\n({score:.2f})" for label, score in zip(labels, scores)],
        startangle=140,
        colors=plt.cm.tab20.colors
    )
    axes[idx].axis('equal')
    axes[idx].set_title(f'{region}', fontsize=12)

for i in range(len(regions), len(axes)):
    fig.delaxes(axes[i])

plt.suptitle('ì§€ì—­ë³„ Top5 í™œë™ í‰ê·  ë§Œì¡±ë„ (í™œë™ëª… + ì ìˆ˜)', fontsize=16)
plt.tight_layout(rect=[0, 0, 1, 0.96])
plt.show()

"""# ì¶©ë‚¨ - ìì—°ê²½ê´€"""

# Q9_2a ì»¬ëŸ¼ ë¦¬ìŠ¤íŠ¸ ì¶”ì¶œ
q9_cols = [col for col in df_cluster1_2024.columns if col.startswith('Q9_2a')]

# ì¶©ë‚¨ì´ í¬í•¨ëœ í–‰ë§Œ í•„í„°ë§
df_chungnam_2024 = df_cluster1_2024[df_cluster1_2024[q9_cols].eq('ì¶©ë‚¨').any(axis=1)]

# í™œë™ ì—¬ë¶€ í•„í„°ë§
is_active = df_chungnam_2024['Q8a03'] == 'ìì—°ê²½ê´€ ê°ìƒ'

# ê°ìƒì ìˆ˜ ë° ë¹„ìœ¨
activity_count = is_active.sum()
total = len(df_chungnam_2024)
activity_rate = activity_count / total if total > 0 else 0

# ë§Œì¡±ë„ ë§¤í•‘ í›„ í‰ê·  ê³„ì‚°
satisfaction_map = {
    'â‘  ë§¤ìš° ë¶ˆë§Œì¡±': 1,
    'â‘¡ ë¶ˆë§Œì¡±': 2,
    'â‘¢ ë³´í†µ': 3,
    'â‘£ ë§Œì¡±': 4,
    'â‘¤ ë§¤ìš° ë§Œì¡±': 5
}

# ë§Œì¡±ë„ ë§¤í•‘ â†’ ìˆ«ìë¡œ ë³€í™˜
satisfaction_scores = df_chungnam_2024.loc[is_active, 'Q12a03'].map(satisfaction_map)
mean_satisfaction = satisfaction_scores.mean()

# ì¶œë ¥
print(f"ğŸ”¹ 2024 ì¶©ë‚¨ ë°©ë¬¸ì ìˆ˜: {total}ëª…")
print(f"ğŸ”¹ ìì—°ê²½ê´€ ê°ìƒì ìˆ˜: {activity_count}ëª…")
print(f"ğŸ”¹ ìì—°ê²½ê´€ ê°ìƒ ë¹„ìœ¨: {activity_rate*100:.1f}%")
print(f"ğŸ”¹ ìì—°ê²½ê´€ ë§Œì¡±ë„ í‰ê· : {mean_satisfaction:.2f}")

import matplotlib.pyplot as plt

# ì‹œê°í™”ìš© ë°ì´í„° ì¤€ë¹„
labels = ['ì¶©ë‚¨']
activity_values = [activity_rate * 100]         # í™œë™ ë¹„ìœ¨ (%)
satisfaction_values = [mean_satisfaction]       # í‰ê·  ë§Œì¡±ë„

fig, ax1 = plt.subplots(figsize=(6, 4))

# ë§‰ëŒ€ ê·¸ë˜í”„: ìì—°ê²½ê´€ ê°ìƒ ë¹„ìœ¨
ax1.bar(labels, activity_values, color='skyblue')
ax1.set_ylabel('ìì—°ê²½ê´€ ê°ìƒ ë¹„ìœ¨ (%)', color='skyblue')
ax1.set_ylim(0, 100)
ax1.tick_params(axis='y', labelcolor='skyblue')

# ì„  ê·¸ë˜í”„: í‰ê·  ë§Œì¡±ë„
ax2 = ax1.twinx()
ax2.plot(labels, satisfaction_values, color='orange', marker='o', linewidth=2)
ax2.set_ylabel('ìì—°ê²½ê´€ ë§Œì¡±ë„ (í‰ê· )', color='orange')
ax2.set_ylim(0, 5)
ax2.tick_params(axis='y', labelcolor='orange')

# ì œëª© ë° ë ˆì´ì•„ì›ƒ
plt.title('ì¶©ë‚¨ ìì—°ê²½ê´€ ê°ìƒ í™œë™ ë¹„ìœ¨ ë° ë§Œì¡±ë„ (2024)')
plt.tight_layout()
plt.show()